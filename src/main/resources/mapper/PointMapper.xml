<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.joo.abysshop.mapper.mybatis.PointMapper">
  <select id="findAllPointRecharge" resultType="java.util.List">
    SELECT *
    FROM point_recharge_table
  </select>

  <insert id="insertPointRecharge"
    parameterType="com.joo.abysshop.entity.point.CreatePointRechargeEntity">
    INSERT INTO point_recharge_table (user_id, nickname, points, request_time,
                                      recharge_request_state)
    VALUES (#{userId}, #{nickname}, #{points}, NOW(), 'pending_payment')
  </insert>

  <update id="changePointRechargeState" parameterType="java.util.Map">
    UPDATE point_recharge_table
    SET recharge_request_state = #{newState}
    WHERE recharge_id = #{rechargeId}
  </update>

  <select id="findPointRechargeDetail" parameterType="java.lang.Long"
    resultType="com.joo.abysshop.entity.point.PointRechargeDetailEntity">
    SELECT *
    FROM point_recharge_detail_table
    WHERE recharge_id = #{rechargeId}
  </select>

  <insert id="insertPointRechargeDetail"
    parameterType="com.joo.abysshop.entity.point.SavePointRechargeDetailEntity">
    INSERT INTO point_recharge_detail_table (recharge_id, user_id, bank, account_number,
                                                 deposit_confirmed_time)
    VALUES (#{rechargeId}, #{userId}, #{bank}, #{accountNumber}, NOW())
  </insert>

  <select id="getUserPointRecharges" parameterType="java.lang.Long" resultType="java.util.List">
    SELECT *
    FROM point_recharge_table
    WHERE user_id = #{userId}
  </select>
</mapper>